#!/bin/sh
set -e

# ----------------------------------------
# âœ… æ°¸ç¶šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆRenderå´ã®ãƒã‚¦ãƒ³ãƒˆå…ˆï¼‰
# ----------------------------------------
mkdir -p /app/pb_data

# ----------------------------------------
# âœ… pb_public.zip ãŒã‚ã‚Œã°è‡ªå‹•å±•é–‹
#    ï¼ˆGitHubã«ZIPã§å…¥ã‚Œã¦ãŠã‘ã°OKï¼‰
# ----------------------------------------
if [ -f /app/pb_public.zip ] && [ ! -d /app/pb_public ]; then
  echo "ğŸ“¦ Unzipping pb_public.zip..."
  unzip -oq /app/pb_public.zip -d /app/pb_public
fi

# ----------------------------------------
# âœ… èµ·å‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
# ----------------------------------------
echo "ğŸš€ Starting PocketBase on port ${PORT:-8080}..."

# ----------------------------------------
# âœ… PocketBaseèµ·å‹•
#    --publicURL ã¯ v0.24.4 ã§å‰Šé™¤ã•ã‚ŒãŸãŸã‚ä¸è¦
# ----------------------------------------
exec /app/pocketbase serve \
  --http=0.0.0.0:${PORT:-8080} \
  --dir=/app/pb_data \
  --publicDir=/app/pb_public
